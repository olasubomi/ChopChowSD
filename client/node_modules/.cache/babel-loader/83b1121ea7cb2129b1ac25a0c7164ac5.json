{"ast":null,"code":"import { __awaiter, __extends, __generator, __rest } from \"tslib\";\nimport { RETRY_MODES } from \"./config\";\nimport { DefaultRateLimiter } from \"./DefaultRateLimiter\";\nimport { StandardRetryStrategy } from \"./StandardRetryStrategy\";\n\nvar AdaptiveRetryStrategy = function (_super) {\n  __extends(AdaptiveRetryStrategy, _super);\n\n  function AdaptiveRetryStrategy(maxAttemptsProvider, options) {\n    var _this = this;\n\n    var _a = options !== null && options !== void 0 ? options : {},\n        rateLimiter = _a.rateLimiter,\n        superOptions = __rest(_a, [\"rateLimiter\"]);\n\n    _this = _super.call(this, maxAttemptsProvider, superOptions) || this;\n    _this.rateLimiter = rateLimiter !== null && rateLimiter !== void 0 ? rateLimiter : new DefaultRateLimiter();\n    _this.mode = RETRY_MODES.ADAPTIVE;\n    return _this;\n  }\n\n  AdaptiveRetryStrategy.prototype.retry = function (next, args) {\n    return __awaiter(this, void 0, void 0, function () {\n      var _this = this;\n\n      return __generator(this, function (_a) {\n        return [2, _super.prototype.retry.call(this, next, args, {\n          beforeRequest: function beforeRequest() {\n            return __awaiter(_this, void 0, void 0, function () {\n              return __generator(this, function (_a) {\n                return [2, this.rateLimiter.getSendToken()];\n              });\n            });\n          },\n          afterRequest: function afterRequest(response) {\n            _this.rateLimiter.updateClientSendingRate(response);\n          }\n        })];\n      });\n    });\n  };\n\n  return AdaptiveRetryStrategy;\n}(StandardRetryStrategy);\n\nexport { AdaptiveRetryStrategy };","map":{"version":3,"sources":["/home/chuka/joe/ChopChowSD/node_modules/@aws-sdk/middleware-retry/dist-es/AdaptiveRetryStrategy.js"],"names":["__awaiter","__extends","__generator","__rest","RETRY_MODES","DefaultRateLimiter","StandardRetryStrategy","AdaptiveRetryStrategy","_super","maxAttemptsProvider","options","_this","_a","rateLimiter","superOptions","call","mode","ADAPTIVE","prototype","retry","next","args","beforeRequest","getSendToken","afterRequest","response","updateClientSendingRate"],"mappings":"AAAA,SAASA,SAAT,EAAoBC,SAApB,EAA+BC,WAA/B,EAA4CC,MAA5C,QAA0D,OAA1D;AACA,SAASC,WAAT,QAA4B,UAA5B;AACA,SAASC,kBAAT,QAAmC,sBAAnC;AACA,SAASC,qBAAT,QAAsC,yBAAtC;;AACA,IAAIC,qBAAqB,GAAI,UAAUC,MAAV,EAAkB;AAC3CP,EAAAA,SAAS,CAACM,qBAAD,EAAwBC,MAAxB,CAAT;;AACA,WAASD,qBAAT,CAA+BE,mBAA/B,EAAoDC,OAApD,EAA6D;AACzD,QAAIC,KAAK,GAAG,IAAZ;;AACA,QAAIC,EAAE,GAAGF,OAAO,KAAK,IAAZ,IAAoBA,OAAO,KAAK,KAAK,CAArC,GAAyCA,OAAzC,GAAmD,EAA5D;AAAA,QAAgEG,WAAW,GAAGD,EAAE,CAACC,WAAjF;AAAA,QAA8FC,YAAY,GAAGX,MAAM,CAACS,EAAD,EAAK,CAAC,aAAD,CAAL,CAAnH;;AACAD,IAAAA,KAAK,GAAGH,MAAM,CAACO,IAAP,CAAY,IAAZ,EAAkBN,mBAAlB,EAAuCK,YAAvC,KAAwD,IAAhE;AACAH,IAAAA,KAAK,CAACE,WAAN,GAAoBA,WAAW,KAAK,IAAhB,IAAwBA,WAAW,KAAK,KAAK,CAA7C,GAAiDA,WAAjD,GAA+D,IAAIR,kBAAJ,EAAnF;AACAM,IAAAA,KAAK,CAACK,IAAN,GAAaZ,WAAW,CAACa,QAAzB;AACA,WAAON,KAAP;AACH;;AACDJ,EAAAA,qBAAqB,CAACW,SAAtB,CAAgCC,KAAhC,GAAwC,UAAUC,IAAV,EAAgBC,IAAhB,EAAsB;AAC1D,WAAOrB,SAAS,CAAC,IAAD,EAAO,KAAK,CAAZ,EAAe,KAAK,CAApB,EAAuB,YAAY;AAC/C,UAAIW,KAAK,GAAG,IAAZ;;AACA,aAAOT,WAAW,CAAC,IAAD,EAAO,UAAUU,EAAV,EAAc;AACnC,eAAO,CAAC,CAAD,EAAIJ,MAAM,CAACU,SAAP,CAAiBC,KAAjB,CAAuBJ,IAAvB,CAA4B,IAA5B,EAAkCK,IAAlC,EAAwCC,IAAxC,EAA8C;AACjDC,UAAAA,aAAa,EAAE,yBAAY;AAAE,mBAAOtB,SAAS,CAACW,KAAD,EAAQ,KAAK,CAAb,EAAgB,KAAK,CAArB,EAAwB,YAAY;AAC7E,qBAAOT,WAAW,CAAC,IAAD,EAAO,UAAUU,EAAV,EAAc;AACnC,uBAAO,CAAC,CAAD,EAAI,KAAKC,WAAL,CAAiBU,YAAjB,EAAJ,CAAP;AACH,eAFiB,CAAlB;AAGH,aAJ4C,CAAhB;AAIxB,WAL4C;AAMjDC,UAAAA,YAAY,EAAE,sBAAUC,QAAV,EAAoB;AAC9Bd,YAAAA,KAAK,CAACE,WAAN,CAAkBa,uBAAlB,CAA0CD,QAA1C;AACH;AARgD,SAA9C,CAAJ,CAAP;AAUH,OAXiB,CAAlB;AAYH,KAde,CAAhB;AAeH,GAhBD;;AAiBA,SAAOlB,qBAAP;AACH,CA5B4B,CA4B3BD,qBA5B2B,CAA7B;;AA6BA,SAASC,qBAAT","sourcesContent":["import { __awaiter, __extends, __generator, __rest } from \"tslib\";\nimport { RETRY_MODES } from \"./config\";\nimport { DefaultRateLimiter } from \"./DefaultRateLimiter\";\nimport { StandardRetryStrategy } from \"./StandardRetryStrategy\";\nvar AdaptiveRetryStrategy = (function (_super) {\n    __extends(AdaptiveRetryStrategy, _super);\n    function AdaptiveRetryStrategy(maxAttemptsProvider, options) {\n        var _this = this;\n        var _a = options !== null && options !== void 0 ? options : {}, rateLimiter = _a.rateLimiter, superOptions = __rest(_a, [\"rateLimiter\"]);\n        _this = _super.call(this, maxAttemptsProvider, superOptions) || this;\n        _this.rateLimiter = rateLimiter !== null && rateLimiter !== void 0 ? rateLimiter : new DefaultRateLimiter();\n        _this.mode = RETRY_MODES.ADAPTIVE;\n        return _this;\n    }\n    AdaptiveRetryStrategy.prototype.retry = function (next, args) {\n        return __awaiter(this, void 0, void 0, function () {\n            var _this = this;\n            return __generator(this, function (_a) {\n                return [2, _super.prototype.retry.call(this, next, args, {\n                        beforeRequest: function () { return __awaiter(_this, void 0, void 0, function () {\n                            return __generator(this, function (_a) {\n                                return [2, this.rateLimiter.getSendToken()];\n                            });\n                        }); },\n                        afterRequest: function (response) {\n                            _this.rateLimiter.updateClientSendingRate(response);\n                        },\n                    })];\n            });\n        });\n    };\n    return AdaptiveRetryStrategy;\n}(StandardRetryStrategy));\nexport { AdaptiveRetryStrategy };\n"]},"metadata":{},"sourceType":"module"}