{"ast":null,"code":"import { Crc32 } from \"@aws-crypto/crc32\";\nvar PRELUDE_MEMBER_LENGTH = 4;\nvar PRELUDE_LENGTH = PRELUDE_MEMBER_LENGTH * 2;\nvar CHECKSUM_LENGTH = 4;\nvar MINIMUM_MESSAGE_LENGTH = PRELUDE_LENGTH + CHECKSUM_LENGTH * 2;\nexport function splitMessage(_a) {\n  var byteLength = _a.byteLength,\n      byteOffset = _a.byteOffset,\n      buffer = _a.buffer;\n\n  if (byteLength < MINIMUM_MESSAGE_LENGTH) {\n    throw new Error(\"Provided message too short to accommodate event stream message overhead\");\n  }\n\n  var view = new DataView(buffer, byteOffset, byteLength);\n  var messageLength = view.getUint32(0, false);\n\n  if (byteLength !== messageLength) {\n    throw new Error(\"Reported message length does not match received message length\");\n  }\n\n  var headerLength = view.getUint32(PRELUDE_MEMBER_LENGTH, false);\n  var expectedPreludeChecksum = view.getUint32(PRELUDE_LENGTH, false);\n  var expectedMessageChecksum = view.getUint32(byteLength - CHECKSUM_LENGTH, false);\n  var checksummer = new Crc32().update(new Uint8Array(buffer, byteOffset, PRELUDE_LENGTH));\n\n  if (expectedPreludeChecksum !== checksummer.digest()) {\n    throw new Error(\"The prelude checksum specified in the message (\".concat(expectedPreludeChecksum, \") does not match the calculated CRC32 checksum (\").concat(checksummer.digest(), \")\"));\n  }\n\n  checksummer.update(new Uint8Array(buffer, byteOffset + PRELUDE_LENGTH, byteLength - (PRELUDE_LENGTH + CHECKSUM_LENGTH)));\n\n  if (expectedMessageChecksum !== checksummer.digest()) {\n    throw new Error(\"The message checksum (\".concat(checksummer.digest(), \") did not match the expected value of \").concat(expectedMessageChecksum));\n  }\n\n  return {\n    headers: new DataView(buffer, byteOffset + PRELUDE_LENGTH + CHECKSUM_LENGTH, headerLength),\n    body: new Uint8Array(buffer, byteOffset + PRELUDE_LENGTH + CHECKSUM_LENGTH + headerLength, messageLength - headerLength - (PRELUDE_LENGTH + CHECKSUM_LENGTH + CHECKSUM_LENGTH))\n  };\n}","map":{"version":3,"sources":["/home/chuka/joe/ChopChowSD/node_modules/@aws-sdk/eventstream-marshaller/dist-es/splitMessage.js"],"names":["Crc32","PRELUDE_MEMBER_LENGTH","PRELUDE_LENGTH","CHECKSUM_LENGTH","MINIMUM_MESSAGE_LENGTH","splitMessage","_a","byteLength","byteOffset","buffer","Error","view","DataView","messageLength","getUint32","headerLength","expectedPreludeChecksum","expectedMessageChecksum","checksummer","update","Uint8Array","digest","concat","headers","body"],"mappings":"AAAA,SAASA,KAAT,QAAsB,mBAAtB;AACA,IAAIC,qBAAqB,GAAG,CAA5B;AACA,IAAIC,cAAc,GAAGD,qBAAqB,GAAG,CAA7C;AACA,IAAIE,eAAe,GAAG,CAAtB;AACA,IAAIC,sBAAsB,GAAGF,cAAc,GAAGC,eAAe,GAAG,CAAhE;AACA,OAAO,SAASE,YAAT,CAAsBC,EAAtB,EAA0B;AAC7B,MAAIC,UAAU,GAAGD,EAAE,CAACC,UAApB;AAAA,MAAgCC,UAAU,GAAGF,EAAE,CAACE,UAAhD;AAAA,MAA4DC,MAAM,GAAGH,EAAE,CAACG,MAAxE;;AACA,MAAIF,UAAU,GAAGH,sBAAjB,EAAyC;AACrC,UAAM,IAAIM,KAAJ,CAAU,yEAAV,CAAN;AACH;;AACD,MAAIC,IAAI,GAAG,IAAIC,QAAJ,CAAaH,MAAb,EAAqBD,UAArB,EAAiCD,UAAjC,CAAX;AACA,MAAIM,aAAa,GAAGF,IAAI,CAACG,SAAL,CAAe,CAAf,EAAkB,KAAlB,CAApB;;AACA,MAAIP,UAAU,KAAKM,aAAnB,EAAkC;AAC9B,UAAM,IAAIH,KAAJ,CAAU,gEAAV,CAAN;AACH;;AACD,MAAIK,YAAY,GAAGJ,IAAI,CAACG,SAAL,CAAeb,qBAAf,EAAsC,KAAtC,CAAnB;AACA,MAAIe,uBAAuB,GAAGL,IAAI,CAACG,SAAL,CAAeZ,cAAf,EAA+B,KAA/B,CAA9B;AACA,MAAIe,uBAAuB,GAAGN,IAAI,CAACG,SAAL,CAAeP,UAAU,GAAGJ,eAA5B,EAA6C,KAA7C,CAA9B;AACA,MAAIe,WAAW,GAAG,IAAIlB,KAAJ,GAAYmB,MAAZ,CAAmB,IAAIC,UAAJ,CAAeX,MAAf,EAAuBD,UAAvB,EAAmCN,cAAnC,CAAnB,CAAlB;;AACA,MAAIc,uBAAuB,KAAKE,WAAW,CAACG,MAAZ,EAAhC,EAAsD;AAClD,UAAM,IAAIX,KAAJ,CAAU,kDAAkDY,MAAlD,CAAyDN,uBAAzD,EAAkF,kDAAlF,EAAsIM,MAAtI,CAA6IJ,WAAW,CAACG,MAAZ,EAA7I,EAAmK,GAAnK,CAAV,CAAN;AACH;;AACDH,EAAAA,WAAW,CAACC,MAAZ,CAAmB,IAAIC,UAAJ,CAAeX,MAAf,EAAuBD,UAAU,GAAGN,cAApC,EAAoDK,UAAU,IAAIL,cAAc,GAAGC,eAArB,CAA9D,CAAnB;;AACA,MAAIc,uBAAuB,KAAKC,WAAW,CAACG,MAAZ,EAAhC,EAAsD;AAClD,UAAM,IAAIX,KAAJ,CAAU,yBAAyBY,MAAzB,CAAgCJ,WAAW,CAACG,MAAZ,EAAhC,EAAsD,wCAAtD,EAAgGC,MAAhG,CAAuGL,uBAAvG,CAAV,CAAN;AACH;;AACD,SAAO;AACHM,IAAAA,OAAO,EAAE,IAAIX,QAAJ,CAAaH,MAAb,EAAqBD,UAAU,GAAGN,cAAb,GAA8BC,eAAnD,EAAoEY,YAApE,CADN;AAEHS,IAAAA,IAAI,EAAE,IAAIJ,UAAJ,CAAeX,MAAf,EAAuBD,UAAU,GAAGN,cAAb,GAA8BC,eAA9B,GAAgDY,YAAvE,EAAqFF,aAAa,GAAGE,YAAhB,IAAgCb,cAAc,GAAGC,eAAjB,GAAmCA,eAAnE,CAArF;AAFH,GAAP;AAIH","sourcesContent":["import { Crc32 } from \"@aws-crypto/crc32\";\nvar PRELUDE_MEMBER_LENGTH = 4;\nvar PRELUDE_LENGTH = PRELUDE_MEMBER_LENGTH * 2;\nvar CHECKSUM_LENGTH = 4;\nvar MINIMUM_MESSAGE_LENGTH = PRELUDE_LENGTH + CHECKSUM_LENGTH * 2;\nexport function splitMessage(_a) {\n    var byteLength = _a.byteLength, byteOffset = _a.byteOffset, buffer = _a.buffer;\n    if (byteLength < MINIMUM_MESSAGE_LENGTH) {\n        throw new Error(\"Provided message too short to accommodate event stream message overhead\");\n    }\n    var view = new DataView(buffer, byteOffset, byteLength);\n    var messageLength = view.getUint32(0, false);\n    if (byteLength !== messageLength) {\n        throw new Error(\"Reported message length does not match received message length\");\n    }\n    var headerLength = view.getUint32(PRELUDE_MEMBER_LENGTH, false);\n    var expectedPreludeChecksum = view.getUint32(PRELUDE_LENGTH, false);\n    var expectedMessageChecksum = view.getUint32(byteLength - CHECKSUM_LENGTH, false);\n    var checksummer = new Crc32().update(new Uint8Array(buffer, byteOffset, PRELUDE_LENGTH));\n    if (expectedPreludeChecksum !== checksummer.digest()) {\n        throw new Error(\"The prelude checksum specified in the message (\".concat(expectedPreludeChecksum, \") does not match the calculated CRC32 checksum (\").concat(checksummer.digest(), \")\"));\n    }\n    checksummer.update(new Uint8Array(buffer, byteOffset + PRELUDE_LENGTH, byteLength - (PRELUDE_LENGTH + CHECKSUM_LENGTH)));\n    if (expectedMessageChecksum !== checksummer.digest()) {\n        throw new Error(\"The message checksum (\".concat(checksummer.digest(), \") did not match the expected value of \").concat(expectedMessageChecksum));\n    }\n    return {\n        headers: new DataView(buffer, byteOffset + PRELUDE_LENGTH + CHECKSUM_LENGTH, headerLength),\n        body: new Uint8Array(buffer, byteOffset + PRELUDE_LENGTH + CHECKSUM_LENGTH + headerLength, messageLength - headerLength - (PRELUDE_LENGTH + CHECKSUM_LENGTH + CHECKSUM_LENGTH)),\n    };\n}\n"]},"metadata":{},"sourceType":"module"}